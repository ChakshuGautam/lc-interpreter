(()=>{var t={987:t=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,i(r.key),r)}}function r(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function i(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=r((function t(e,n){a(this,t),this.type=e,this.value=n}));["EOF","LAMBDA","LPAREN","RPAREN","LCID","DOT"].forEach((function(t){s[t]=t}));var o=function(){return r((function t(e){a(this,t),this._input=e,this._index=0,this._token=void 0,this._nextToken()}),[{key:"_nextChar",value:function(){return this._index>=this._input.length?"\0":this._input[this._index++]}},{key:"_nextToken",value:function(){var t=this._nextChar();if("\0"!==t)if("("!==t)if(")"!==t)if("."!==t)if("\\"!==t)if(" "!==t){if(!/[a-z]/.test(t))throw new Error("Unexpected character: ".concat(t));this._token=new s(s.LCID,t)}else this._nextToken();else this._token=new s(s.LAMBDA,t);else this._token=new s(s.DOT,t);else this._token=new s(s.RPAREN,t);else this._token=new s(s.LPAREN,t);else this._token=new s(s.EOF,"")}},{key:"next",value:function(t){return this._token.type===t}},{key:"peek",value:function(){return this._token.value}},{key:"skip",value:function(t){if(this.next(t)){var e=this._token.value;return this._nextToken(),e}return!1}},{key:"match",value:function(t){if(!this.next(t))throw new Error("Expected token: ".concat(t));var e=this._token.value;return this._nextToken(),e}},{key:"token",value:function(t){if(!this.next(t))throw new Error("Expected token: ".concat(t));var e=this._token.value;return this._nextToken(),e}}])}(),u=function(){return r((function t(e,n){a(this,t),this.param=e,this.body=n}),[{key:"toString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=this.body instanceof h?"(".concat(this.body.toString([this.param].concat(t)),")"):this.body.toString([this.param].concat(t));return"(Î»".concat(this.param,". ").concat(e,")")}}])}(),h=function(){function t(e,n){a(this,t),this.lhs=e,this.rhs=n}return r(t,[{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=this.lhs instanceof t?"(".concat(this.lhs.toString(e),")"):this.lhs.toString(e),r=this.rhs instanceof t?"(".concat(this.rhs.toString(e),")"):this.rhs.toString(e);return"".concat(n," ").concat(r)}}])}(),f=function(){return r((function t(e){a(this,t),this.value=e}),[{key:"toString",value:function(){return this.value}}])}(),c=function(){return r((function t(e){a(this,t),this.lexer=new o(e)}),[{key:"parseTerm",value:function(){if(this.lexer.skip(s.LAMBDA)){var t=this.lexer.token(s.LCID);this.lexer.match(s.DOT);var e=this.parseTerm();return new u(t,e)}return this.parseApplication()}},{key:"parseAtom",value:function(){if(this.lexer.skip(s.LPAREN)){var t=this.parseTerm();return this.lexer.match(s.RPAREN),t}if(this.lexer.next(s.LCID)){var e=this.lexer.token(s.LCID);return new f(e)}throw new Error("Expected atom")}},{key:"parseApplication",value:function(){for(var t=this.parseAtom();!this.lexer.next(s.EOF)&&!this.lexer.next(s.RPAREN)&&!this.lexer.next(s.DOT);){var e=this.parseAtom();t=new h(t,e)}return t}},{key:"parse",value:function(){var t=this.parseTerm();return this.lexer.match(s.EOF),t}}])}(),l=function(){return r((function t(e){a(this,t),this.parser=new c(e),this.AST={Application:h,Abstraction:u,Identifier:f}}),[{key:"evaluate",value:function(){var t=this.parser.parse();return this._evaluate(t)}},{key:"_isValue",value:function(t){return t instanceof this.AST.Abstraction||t instanceof this.AST.Identifier}},{key:"_evaluate",value:function(t){for(;;){if(!(t instanceof this.AST.Application))return this._isValue(t),t;if(this._isValue(t.lhs)&&this._isValue(t.rhs)){if(!(t.lhs instanceof this.AST.Abstraction))return t;t=this._substitute(t.lhs.param,t.rhs,t.lhs.body)}else this._isValue(t.lhs)?t.rhs=this._evaluate(t.rhs):t.lhs=this._evaluate(t.lhs)}}},{key:"_substitute",value:function(t,e,n){if(n instanceof this.AST.Identifier)return n.value===t?e:n;if(n instanceof this.AST.Application)return new this.AST.Application(this._substitute(t,e,n.lhs),this._substitute(t,e,n.rhs));if(n instanceof this.AST.Abstraction){if(n.param===t)return n;if(this._getFreeVariables(e).has(n.param)){var r=this._freshVariable(n.param),i=this._substitute(n.param,new this.AST.Identifier(r),n.body);return new this.AST.Abstraction(r,this._substitute(t,e,i))}return new this.AST.Abstraction(n.param,this._substitute(t,e,n.body))}}},{key:"_getFreeVariables",value:function(t){var e=new Set;return t instanceof this.AST.Identifier?e.add(t.value):t instanceof this.AST.Application?(this._getFreeVariables(t.lhs).forEach((function(t){return e.add(t)})),this._getFreeVariables(t.rhs).forEach((function(t){return e.add(t)}))):t instanceof this.AST.Abstraction&&this._getFreeVariables(t.body).forEach((function(n){n!==t.param&&e.add(n)})),e}},{key:"_freshVariable",value:function(t){this._usedVariables||(this._usedVariables=new Set);for(var e=1,n="".concat(t,"'");this._usedVariables.has(n);)n="".concat(t,"'").concat(e++);return this._usedVariables.add(n),n}}])}();t.exports={Parser:c,Abstraction:u,Application:h,Identifier:f,Interpreter:l}}},e={};function n(r){var i=e[r];if(void 0!==i)return i.exports;var a=e[r]={exports:{}};return t[r](a,a.exports,n),a.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";var t=n(987),e=new Terminal({cursorBlink:!0,fontSize:16,fontFamily:"'Fira Code', monospace",letterSpacing:0,lineHeight:1.2,fontWeight:500,fontWeightBold:700,allowTransparency:!0,theme:{background:"#282a36",foreground:"#f8f8f2",cursor:"#ff79c6",cursorAccent:"#282a36",selection:"#44475a",selectionForeground:"#ffffff",black:"#21222c",red:"#ff5555",green:"#50fa7b",yellow:"#f1fa8c",blue:"#bd93f9",magenta:"#ff79c6",cyan:"#8be9fd",white:"#f8f8f2",brightBlack:"#6272a4",brightRed:"#ff6e6e",brightGreen:"#69ff94",brightYellow:"#ffffa5",brightBlue:"#d6acff",brightMagenta:"#ff92df",brightCyan:"#a4ffff",brightWhite:"#ffffff"},windowOptions:{fullscreenWin:!0},rendererType:"canvas"});e.open(document.getElementById("terminal")),e.write("Lambda Calculus Interpreter\r\n"),e.write("Hello from [1;3;31mxterm.js[0m $ "),e.write("[38;5;141mType an expression (e.g. \\x. x) and press Enter[0m\r\n\r\n"),e.write("[38;5;212mÎ»>[0m ");var r="";e.onData((function(n){switch(n){case"\r":if(e.write("\r\n"),r.trim())try{var i=new t.Interpreter(r.trim()).evaluate();e.write("[38;5;84m".concat(i.toString(),"[0m\r\n"))}catch(t){e.write("[38;5;203mError: ".concat(t.message,"[0m\r\n"))}e.write("[38;5;212mÎ»>[0m "),r="";break;case"":r.length>0&&(r=r.slice(0,-1),e.write("\b \b"));break;default:n>=" "&&n<="~"&&(r+=n,e.write(n))}}))})()})();